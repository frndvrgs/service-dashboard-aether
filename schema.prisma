generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------------------------------------------------
// -- ACCOUNT MODULE
// --------------------------------------------------------------------------------

model Account {
  id            Int          @id @default(autoincrement())
  idAccount     String       @unique @map("id_account") @db.Uuid
  createdAt     DateTime     @map("created_at") @db.Timestamptz
  updatedAt     DateTime     @map("updated_at") @db.Timestamptz
  email         String       @unique
  password      String
  scope         String       @default("user")
  document      Json         @default("{}")
  subscription  Subscription?
  works         Work[]
  profile       Profile?

  @@map("account")
}

model AccountView {
  idAccount     String   @unique @map("id_account") @db.Uuid
  createdAt     DateTime @map("created_at") @db.Timestamptz
  updatedAt     DateTime @map("updated_at") @db.Timestamptz
  email         String   @unique
  scope         String   @default("user")
  document      Json     @default("{}")

  @@map("account_view")
}

model Subscription {
  id             Int      @id @default(autoincrement())
  idSubscription String   @unique @map("id_subscription") @db.Uuid
  idAccount      String   @unique @map("id_account") @db.Uuid
  createdAt      DateTime @map("created_at") @db.Timestamptz
  updatedAt      DateTime @map("updated_at") @db.Timestamptz
  type           String
  status         String
  document       Json     @default("{}")
  account        Account  @relation(fields: [idAccount], references: [idAccount])

  @@map("subscription")
}

model SubscriptionView {
  idSubscription String   @unique @map("id_subscription") @db.Uuid
  idAccount      String   @unique @map("id_account") @db.Uuid
  createdAt      DateTime @map("created_at") @db.Timestamptz
  updatedAt      DateTime @map("updated_at") @db.Timestamptz
  type           String
  status         String
  document       Json     @default("{}")

  @@map("subscription_view")
}

// --------------------------------------------------------------------------------
// -- PRODUCT MODULE
// --------------------------------------------------------------------------------

model Work {
  id         Int      @id @default(autoincrement())
  idWork     String   @unique @map("id_work") @db.Uuid
  idAccount  String   @map("id_account") @db.Uuid
  idFeature  String   @map("id_feature") @db.Uuid
  createdAt  DateTime @map("created_at") @db.Timestamptz
  updatedAt  DateTime @map("updated_at") @db.Timestamptz
  name       String
  level      Decimal  @db.Decimal(5, 2)
  document   Json     @default("{}")
  account    Account  @relation(fields: [idAccount], references: [idAccount], onDelete: Cascade)

  @@map("work")
}

model WorkView {
  idWork     String   @unique @map("id_work") @db.Uuid
  idAccount  String   @map("id_account") @db.Uuid
  idFeature  String   @map("id_feature") @db.Uuid
  createdAt  DateTime @map("created_at") @db.Timestamptz
  updatedAt  DateTime @map("updated_at") @db.Timestamptz
  name       String
  level      Decimal  @db.Decimal(5, 2)
  document   Json     @default("{}")

  @@map("work_view")
}

// --------------------------------------------------------------------------------
// -- CONTENT MODULE
// --------------------------------------------------------------------------------

model Profile {
  id         Int      @id @default(autoincrement())
  idProfile  String   @unique @map("id_profile") @db.Uuid
  idAccount  String   @unique @map("id_account") @db.Uuid
  createdAt  DateTime @map("created_at") @db.Timestamptz
  updatedAt  DateTime @map("updated_at") @db.Timestamptz
  username   String   @unique
  name       String
  document   Json     @default("{}")
  account    Account  @relation(fields: [idAccount], references: [idAccount], onDelete: Cascade)

  @@map("profile")
}

model ProfileView {
  id         Int      @id @default(autoincrement())
  idProfile  String   @unique @map("id_profile") @db.Uuid
  idAccount  String   @unique @map("id_account") @db.Uuid
  createdAt  DateTime @map("created_at") @db.Timestamptz
  updatedAt  DateTime @map("updated_at") @db.Timestamptz
  username   String   @unique
  name       String
  document   Json     @default("{}")

  @@map("profile_view")
}

model Feature {
  id               Int      @id @default(autoincrement())
  idFeature        String   @unique @map("id_feature") @db.Uuid
  createdAt        DateTime @map("created_at") @db.Timestamptz
  updatedAt        DateTime @map("updated_at") @db.Timestamptz
  name             String
  subscriptionScope String[] @map("subscription_scope")
  document         Json     @default("{}")

  @@map("feature")
}

model FeatureView {
  id               Int      @id @default(autoincrement())
  idFeature        String   @unique @map("id_feature") @db.Uuid
  createdAt        DateTime @map("created_at") @db.Timestamptz
  updatedAt        DateTime @map("updated_at") @db.Timestamptz
  name             String
  subscriptionScope String[] @map("subscription_scope")
  document         Json     @default("{}")

  @@map("feature_view")
}